define("wiki-lemma:widget/lemma_content/configModule/secondsKnow/secondsKnow",function(e,a,i){{var t=e("wiki-common:widget/lib/jquery/jquery"),n=e("wiki-common:widget/lib/jsmart/jsmart"),o=e("wiki-common:widget/ui/dialog/dialog"),s=e("wiki-common:widget/ui/videoPlayer/videoPlayer"),l=e("wiki-common:widget/ui/bubble/bubble"),d=e("wiki-common:widget/component/share/share"),c=e("wiki-lemma:widget/tools/newSideShare/qrcode"),r=e("wiki-common:widget/component/nslog/nslog"),m=e("wiki-common:widget/util/browser"),g=e("wiki-common:widget/util/url");e("wiki-common:widget/lib/swfObject/swfObject")}i.exports=function(a,i,w){function p(){b instanceof o&&b.hide()}function v(e){var a=27;(e.keyCode===a||e.which===a)&&p()}function h(){t.ajax({url:"/api/wikisecond/playurl",type:"GET",data:{mediaIds:K.join(","),platform:"lemma",t:Date.now()},cache:!1,success:function(e){if(e&&0===e.errno&&t.isArray(e.list))for(var a=0;a<e.list.length;a++)t.each(u,function(i,t){return t.mediaId===e.list[a].mediaId?(t.videoSrc.playUrl=e.list[a].playUrl,!1):void 0})}})}function y(e,a){var i=0;if(t.each(u,function(a,t){t.mediaId==e&&(i=a)}),"letvPlayer"===u[i].videoSrc.type)return void window.open(u[i].playUrl);b.show(),"baikePlayer"===u[i].videoSrc.type?t(".lemmaWgt-secondsKnow-dialog .share-btn").show():t(".lemmaWgt-secondsKnow-dialog .share-btn").hide(),f&&"function"==typeof f.destroy&&f.destroy(),f=new s(".lemmaWgt-secondsKnow-dialog .player-container",u[i].videoSrc,{width:685,height:390}),t.getJSON("/wikisecond/viewnum?type=set&secondId="+a+"&mediaId="+e+"&secondKind="+u[i].videoSrc.secondKind);var n=t('.lemmaWgt-secondsKnow-dialog li[data-mediaId="'+e+'"]');n.addClass("play").siblings().removeClass("play"),t(".lemmaWgt-secondsKnow-dialog .bar-title").text(u[i].title).attr("title",u[i].title),t(".bar-vv-num").text(n.attr("data-playNum"))}var u=a.secondsKnow;r({type:10002501,lemmaTitle:w,newLemmaId:i});var f,b;b=new o({classNames:"lemmaWgt-secondsKnow-dialog",hasCloseBtn:!0,content:new n('<div class="lemmaWgt-secondsKnow-dialog-content" {%if $videoSrcList|count > 1%}style="width: 900px"{%/if%} data-shareSrc="{%$videoSrcList[0].videoSrc.cover_small|wiki_common_https_trans|f_escape_xml%}">\n<div class="dialog-player">\n<div class="player-container"></div>\n<div class="player-bar">\n<span class="bar-title"></span>\n<span class="bar-vv"><em class="wiki-lemma-icons wiki-lemma-icons_eye"></em><span class="bar-vv-num"></span></span>\n<a class="share-btn" nslog-type="10002510">\n<em class="cmn-icon cmn-icons cmn-icons_share"></em>\n</a>\n</div>\n</div>\n<div class="dialog-list" {%if $videoSrcList|count <= 1%}style="display:none"{%/if%}>\n<div class="list-title">更多视频&nbsp;<span>{%$videoSrcList|count|f_escape_xml%}个</span></div>\n<ul class="list-gallery">\n{%foreach $videoSrcList as $i => $video%}\n<li data-mediaId="{%$video.mediaId|f_escape_xml%}" data-secondId="{%$video.secondId|f_escape_xml%}">\n<a href="javascript:;" nslog-type="10002504">\n<img src="{%$video.videoSrc.cover_small|wiki_common_https_trans|f_escape_xml%}" />\n<span class="video-shadow">正在播放</span>\n<span class="video-pv"></span>\n</a>\n<div title="{%$video.title|f_escape_xml%}" class="video-title">{%$video.title|f_escape_xml%}</div>\n</li>\n{%/foreach%}\n</ul>\n</div>\n</div>\n').fetch({videoSrcList:u}),onShow:function(){t("body").on("keydown",v)},onHide:function(){r(10002503),t("body").off("keydown",v),f&&"function"==typeof f.destroy&&f.destroy()}});var I=new l({host:t(".lemmaWgt-secondsKnow-dialog .share-btn"),content:'<li class="bubble-content">                      <a href="javascript:;" nslog-type="10002511" data-channel="wechat"><em class="cmn-icon cmn-icons cmn-icons_logo-wechat"></em></a>                      <a href="javascript:;" nslog-type="10002512" data-channel="qzone"><em class="cmn-icon cmn-icons cmn-icons_logo-qzone"></em></a>                      <a href="javascript:;" nslog-type="10002513" data-channel="qq"><em class="cmn-icon cmn-icons cmn-icons_logo-qq"></em></a>                      <a href="javascript:;" nslog-type="10002514" data-channel="weibo"><em class="cmn-icon cmn-icons cmn-icons_logo-sina-weibo"></em></a>                </li>',classNames:"lemmaWgt-secondsKnow-dialog-bubble",marginFromHost:15,pos:"leftAuto",showTail:!0,hideWhenBlur:!0,animation:"SLIDE"});t(".lemmaWgt-secondsKnow-dialog .share-btn").on("click",function(){I.show()}),t(I.getNode()).on("click",'a:not([data-channel="wechat"])',function(){var e=t(this).attr("data-channel"),a=t(".lemmaWgt-secondsKnow-dialog .list-gallery li.play").index()>-1?t(".lemmaWgt-secondsKnow-dialog .list-gallery li.play").index():0,n=t(".lemmaWgt-secondsKnow-dialog .list-gallery li").eq(a);d.openShareLink(e,{url:"https://baike.baidu.com/wikisecond/videoflow?lemmaId="+i+"&mediaId="+n.attr("data-mediaId")+"&secondId="+n.attr("data-secondId"),title:"快速了解"+t("title").text().split("_")[0]+"，就在百科秒懂视频！",pic:t(".lemmaWgt-secondsKnow-dialog .list-gallery li.play img").attr("src")||t(".lemmaWgt-secondsKnow-dialog").find(".lemmaWgt-secondsKnow-dialog-content").attr("data-shareSrc")})});var k=new l({host:t(I.getNode()).find('[data-channel="wechat"]'),content:'<div class="bubble-content"></div>',classNames:"lemmaWgt-secondsKnow-dialog-qrcode-bubble",marginFromHost:15,pos:"topAuto",showTail:!0,hideWhenBlur:!0,animation:"SLIDE"});t(I.getNode()).on("click",'a[data-channel="wechat"]',function(){var e=new c(t(k.getNode()).find("div").get(0),{width:180,height:180}),a=t(".lemmaWgt-secondsKnow-dialog .list-gallery li.play").index()>-1?t(".lemmaWgt-secondsKnow-dialog .list-gallery li.play").index():0,n=t(".lemmaWgt-secondsKnow-dialog .list-gallery li").eq(a);e.makeCode("https://baike.baidu.com/wikisecond/videoflow?lemmaId="+i+"&mediaId="+n.attr("data-mediaId"))+"&secondId="+n.attr("data-secondId"),k.show()}),(!m.ie()||m.ie()>8)&&e.async(["wiki-lemma:widget/lemma_content/configModule/secondsKnow/perfect-scrollbar/index"],function(e){u.length>1&&e.initialize(t(".lemmaWgt-secondsKnow-dialog .list-gallery").get(0),{wheelSpeed:2,wheelPropagation:!0,minScrollbarLength:20,stopPropagationOnClick:!1})});var K=[];if(t.each(u,function(e,a){a.mediaId&&a.videoSrc&&1===parseInt(a.videoSrc.secondKind,10)&&K.push(a.mediaId)}),K.length){h();{var W=15e5;setInterval(h,W)}}t(".lemmaWgt-secondsKnow-dialog .list-gallery").on("click","li:not(.play)",function(){y(t(this).attr("data-mediaId"),t(this).attr("data-secondId"))}),t("#lemmaWgt-secondsKnow .lemmaWgt-secondsKnow-gallery").on("click","li",function(){y(t(this).attr("data-mediaId"),t(this).attr("data-secondId"))}),t.ajax({type:"GET",url:"/api/wikisecond/modulemedialistsort",data:{lemmaId:i},dataType:"json",success:function(e){var i=t(".lemmaWgt-secondsKnow-gallery li"),n=t(".dialog-list .list-gallery li");e&&t.isArray(e.sort)&&(t.each(e.sort,function(e,a){var t=a.playNum;if(parseInt(t,10)>=1e4){if(t=parseInt(t,10)/1e4,t.toString().indexOf(".")>-1){var o=t.toString();t=o.substr(0,o.indexOf(".")+2)}t+="w"}i.filter("[data-secondId="+a.secondId+"]").attr("data-position",e).attr("data-playNum",a.playNum).find(".video-title-vv").append(t),n.filter("[data-secondId="+a.secondId+"]").attr("data-position",e).attr("data-playNum",a.playNum)}),i.sort(function(e,a){return parseInt(t(e).attr("data-position"),10)-parseInt(t(a).attr("data-position"),10)}),n.sort(function(e,a){return parseInt(t(e).attr("data-position"),10)-parseInt(t(a).attr("data-position"),10)}));var o=t(".lemmaWgt-secondsKnow-gallery");o.html(i);var s=3;"largeFeature"===a.type&&(s=2),"pageBg"===a.type&&(s=1),o.children().length>s&&o.find("li:gt("+(s-1)+")").remove(),o.css("opacity",1),t(".dialog-list .list-gallery").html(n)},error:function(){t(".lemmaWgt-secondsKnow-gallery").css("opacity",1)},complete:function(){var e,a,i=g.getQuery("mediaId",window.location.search);(e=t('.lemmaWgt-secondsKnow-dialog .list-gallery li[data-mediaId="'+i+'"]').get(0))?a=e.getAttribute("data-secondId"):(e=t('.lemmaWgt-secondsKnow li[data-mediaId="'+i+'"]').get(0))&&(a=e.getAttribute("data-secondId")),i&&e&&y(i,a)}})}});